<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sass to CSS Playground</title>
</head>
<body>
  <h1>Sass to CSS Playground</h1>
  <div>
    <textarea id="sassInput" rows="10" cols="50" placeholder="Enter your main Sass here...">
@use 'secondary' as secondary;
.test {
  background: red;
  &-2 { 
    padding: secondary.$padding; 
  }
}
    </textarea>
  </div>
  <div>
    <textarea id="sassSecondaryInput" rows="10" cols="50" placeholder="Enter your secondary Sass here...">
$padding: 2rem;
    </textarea>
  </div>
  <div>
    <textarea id="cssOutput" rows="10" cols="50" placeholder="CSS Output..." readonly></textarea>
  </div>
  <div>
    <textarea id="errorOutput" rows="5" cols="50" placeholder="Error Log..." readonly></textarea>
  </div>

  <script type="module">
    async function compileSass() {
      try {
        const sass = await import('https://jspm.dev/sass');

        // Retrieve the Sass inputs
        const mainSass = document.getElementById('sassInput').value;
        const secondarySass = document.getElementById('sassSecondaryInput').value;

        // Create a Blob URL for the secondary file
        const secondaryBlob = new Blob([secondarySass], { type: 'text/plain' });
        const secondaryUrl = URL.createObjectURL(secondaryBlob);

        // Define a custom importer to handle Blob URLs
        const importer = {
          canonicalize(url) {
            if (url === 'secondary') {
              return new URL('file:///secondary');
            }
            return new URL(`file:///${url}`);
          },
          load(canonicalUrl) {
            if (canonicalUrl.href === 'file:///secondary') {
              return { contents: secondarySass, syntax: 'scss' };
            }
            return null;
          }
        };

        // Compile the main Sass file with the custom importer
        const result = sass.compileString(mainSass, {
          importers: [importer],
          url: new URL('file:///main.scss')
        });

        document.getElementById('cssOutput').value = result.css;
        document.getElementById('errorOutput').value = ''; // Clear any previous errors
      } catch (error) {
        document.getElementById('errorOutput').value = error.message;
      }
    }

    document.getElementById('sassInput').addEventListener('input', compileSass);
    document.getElementById('sassSecondaryInput').addEventListener('input', compileSass);

    // Initial compilation on page load
    compileSass();
  </script>
</body>
</html>
